<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website</title>
    <link href="/css/main.css" rel="stylesheet">
</head>
<body>
    <%- include("Blocks/header") -%>

    <% if (role == "Admin") { %>
        <li><a href="/admusers">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a></li>
    <% } %>

    <div class="container">
        <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <%= user %>!</h1>

        <% if (user) { %>
            <a href="/profile/edit"><button>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button></a>
        <% } %>

        <p>–í–æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–µ–∑–Ω—ã—Ö —Å—Å—ã–ª–æ–∫:</p>
        <ul>
            <li><a href="https://www.google.com">Google</a></li>
            <li><a href="https://www.wikipedia.org">Wikipedia</a></li>
            <li><a href="https://www.github.com">GitHub</a></li>
            <li><a href="https://www.youtube.com">YouTube</a></li>
            <li><a href="https://www.reddit.com">Reddit</a></li>
            <li><a href="https://www.stackoverflow.com">Stack Overflow</a></li>
        </ul>

        <% if (role == "Admin") { %>
            <li><a href="/admusers">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a></li>
        <% } %>

    </div>

    <div id="chat-widget">
        <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è/–∑–∞–∫—Ä—ã—Ç–∏—è —á–∞—Ç–∞ -->
        <div class="chat-button" onclick="toggleChat()">
            üí¨
        </div>
        
        <!-- –°–∞–º–æ –æ–∫–Ω–æ —á–∞—Ç–∞, –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç–æ–µ -->
        <div id="chat-box" class="hidden">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —Ç–æ–∂–µ –º–æ–∂–Ω–æ –Ω–∞–∂–∞—Ç—å –¥–ª—è —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è -->
            <div class="chat-header" onclick="toggleChat()">–ß–∞—Ç</div>
    
            <!-- –ë–ª–æ–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π -->
            <div id="messages" class="chat-messages"></div>
    
            <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è + –∫–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
            <div class="chat-input">
                <input id="messageInput" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." autocomplete="off">
                <button onclick="sendMessage()">‚û§</button>
            </div>
        </div>
    </div>
    
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Socket.io –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å WebSocket -->
    <script src="/socket.io/socket.io.js"></script>
    
    <script>
        // –°–æ–∑–¥–∞—ë–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º —á–µ—Ä–µ–∑ WebSocket
        const socket = io();
    
        // –ü–æ–ª—É—á–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ HTML-—ç–ª–µ–º–µ–Ω—Ç—ã
        const messages = document.getElementById('messages'); // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
        const input = document.getElementById('messageInput'); // –ü–æ–ª–µ –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞
        const chatBox = document.getElementById('chat-box'); // –°–∞–º–æ –æ–∫–Ω–æ —á–∞—Ç–∞
    
        // –ü–æ–ª—É—á–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
        socket.on('chat message', (msg) => {
            // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è
            const div = document.createElement('div');
            div.classList.add('message'); // –î–æ–±–∞–≤–ª—è–µ–º CSS-–∫–ª–∞—Å—Å –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏
    
            // –°–æ–∑–¥–∞—ë–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const usernameDiv = document.createElement('span');
            usernameDiv.classList.add('username'); // CSS-–∫–ª–∞—Å—Å
            usernameDiv.textContent = msg.username; // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            div.appendChild(usernameDiv); // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è
    
            // –°–æ–∑–¥–∞—ë–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
            const messageDiv = document.createElement('span');
            messageDiv.classList.add('message-text'); // CSS-–∫–ª–∞—Å—Å
            messageDiv.textContent = ': ' + msg.text; // –°–∞–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
            div.appendChild(messageDiv); // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è
    
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
            messages.appendChild(div);
    
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —á–∞—Ç –≤–Ω–∏–∑, —á—Ç–æ–±—ã –±—ã–ª–æ –≤–∏–¥–Ω–æ –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            messages.scrollTop = messages.scrollHeight;
        });
    
        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
        function sendMessage() {
            const msg = input.value.trim(); // –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
            if (msg) { // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç—Ä–æ–∫–∞ –Ω–µ –ø—É—Å—Ç–∞—è
                socket.emit('chat message', msg); // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                input.value = ''; // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            }
        }
    
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –Ω–∞–∂–∞—Ç–∏–µ –∫–ª–∞–≤–∏—à–∏ Enter –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
        input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
    
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è –∏ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è —á–∞—Ç–∞
        function toggleChat() {
            chatBox.classList.toggle('hidden'); // –î–æ–±–∞–≤–ª—è–µ—Ç/—É–±–∏—Ä–∞–µ—Ç –∫–ª–∞—Å—Å "hidden"
        }
    </script>
</body>
</html>
